<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.rency.crawler.dao.WebPageDao">
	<cache  eviction="FIFO" flushInterval="60000" size="512" readOnly="false"/>
	
	<select id="list" resultType="WebPage">
		select * from t_crawler_web_page
	</select>
	
	<select id="getByUrl" parameterType="String" resultType="WebPage">
		select * from t_crawler_web_page where url=#{url} order by execDate
	</select>
	
	<select id="getByMD5" parameterType="String" resultType="WebPage">
		select * from t_crawler_web_page where contentMD5=#{contentMD5} order by execDate
	</select>
	
	<select id="getUnIndexerWithOne" parameterType="String" resultType="WebPage">
		select * from t_crawler_web_page where isCreateIndex=false order by asc execDate limit 1
	</select>
	
	<insert id="save" parameterType="WebPage">
		insert into t_crawler_web_page (url, contentMD5, charset, content, createIndex, dataLength, description, html, keywords, lastModified, title,execDate)
		values (#{url},#{contentMD5},#{charset},#{content},#{createIndex},#{dataLength},#{description},#{html},#{keywords},#{lastModified},#{title},#{execDate});
	</insert>
	
	<update id="update" parameterType="WebPage">
		update t_crawler_web_page set 
		
		<if test="dataLength != 0">
			dataLength = #{dataLength},
		</if>
		<if test="html != null || html != ''">
			html = #{html},
		</if>
		<if test="content != null || content != ''">
			content = #{content},
		</if>
		<if test="charset != null || charset != ''">
			charset = #{charset},
		</if>
		<if test="isCreateIndex == true">
			isCreateIndex = #{isCreateIndex},
		</if>
		<if test="title != null || title != ''">
			title = #{title},
		</if>
		<if test="keywords != null || keywords != ''">
			keywords = #{keywords},
		</if>
		<if test="description != null || description != ''">
			description = #{description},
		</if>
		<if test="lastModified != null || lastModified != ''">
			lastModified = #{lastModified},
		</if>
		<if test="execDate != null">
			path = #{execDate},
		</if>
		where url = #{url} and contentMD5=#{contentMD5}
	</update>
	
	<delete id="deleteByMD5" parameterType="String">
		delete from t_crawler_web_page where contentMD5=#{contentMD5}
	</delete>
	
	<delete id="deleteByUrl" parameterType="String">
		delete from t_crawler_web_page where url=#{url}
	</delete>
	
	<delete id="deleteAll">
		delete from t_crawler_web_page
	</delete>
	
</mapper>